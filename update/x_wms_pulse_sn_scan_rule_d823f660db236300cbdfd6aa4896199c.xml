<?xml version="1.0" encoding="UTF-8"?><record_update table="x_wms_pulse_sn_scan_rule">
    <x_wms_pulse_sn_scan_rule action="INSERT_OR_UPDATE">
        <active>true</active>
        <advanced>true</advanced>
        <applies_to/>
        <condition/>
        <impact_level>high</impact_level>
        <impact_type>best_practices</impact_type>
        <recommendation>Version in this update set is not the latest!</recommendation>
        <script><![CDATA[// Result should be an array of findings
// A finding should have the following attributes: type, criticality, record_table, record_sys_id and recommendation
// Before returning result, JSON.stringify it.
// Example: result = '[{"type":"Consistency","criticality":"High","record_sys_id":"69df2b704fbc620024cf4e328110c7f5","record_table":"ldap_ou_config","recommendation":"Version in this update set is not the latest!"},{"type":"Consistency","criticality":"High","record_sys_id":"acfa8cc34f20220024cf4e328110c74f","record_table":"sys_dictionary","recommendation":"Version in this update set is not the latest!"}]';
// 'current' is the Code itself, related to the table that this applies (It's null in case you don't have a table set)
// 'update_set_item' is the sys_update_xml item
// 'setID' is the update set sys_id

(function (current, update_set_item, setID) {
	var grXMLs = new GlideRecord('sys_update_xml');
	grXMLs.addQuery('update_set', setID);
	grXMLs.query();
	result = '';
	var findings = [];
	var finding;
	while (grXMLs.next()) {
		var itemSysID = grXMLs.name.substr(-32, 32);
		if (itemSysID.length != 32) {
			continue;
		}
		
		var itemTable = grXMLs.name.replace('_' + itemSysID, '');
		
		var checkVersion = new GlideRecord('sys_update_version');
		checkVersion.addQuery('name', grXMLs.name);
		checkVersion.addQuery('state', 'current');
		checkVersion.query();

		if (checkVersion.next()) {
			if (checkVersion.source != setID) {
				finding = {
				  record_sys_id : itemSysID + '',
				  record_table : itemTable + '',
				  update_xml_sys_id : grXMLs.sys_id + '',
				  recommendation : 'Version in this update set is not the latest. Please check! Latest on [' + checkVersion.source.getDisplayValue() + ']',
				};
				findings.push(finding);
			}
		}
	}
	result = JSON.stringify(findings);
})(current, update_set_item, setID);]]></script>
        <short_description>Check Version</short_description>
        <sys_class_name>x_wms_pulse_sn_scan_rule</sys_class_name>
        <sys_created_by>mmoreli</sys_created_by>
        <sys_created_on>2019-02-07 20:42:27</sys_created_on>
        <sys_id>d823f660db236300cbdfd6aa4896199c</sys_id>
        <sys_mod_count>9</sys_mod_count>
        <sys_name>Check Version</sys_name>
        <sys_package display_value="Pulse" source="x_wms_pulse">e970e883db6bdb0c1f0d322b7c9619a2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Pulse">e970e883db6bdb0c1f0d322b7c9619a2</sys_scope>
        <sys_update_name>x_wms_pulse_sn_scan_rule_d823f660db236300cbdfd6aa4896199c</sys_update_name>
        <sys_updated_by>mmoreli</sys_updated_by>
        <sys_updated_on>2019-02-11 21:08:42</sys_updated_on>
    </x_wms_pulse_sn_scan_rule>
</record_update>
