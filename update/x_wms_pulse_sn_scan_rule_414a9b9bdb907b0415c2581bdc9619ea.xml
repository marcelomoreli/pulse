<?xml version="1.0" encoding="UTF-8"?><record_update table="x_wms_pulse_sn_scan_rule">
    <x_wms_pulse_sn_scan_rule action="INSERT_OR_UPDATE">
        <active>true</active>
        <advanced>true</advanced>
        <applies_to>sys_transform_entry</applies_to>
        <condition/>
        <impact_level>medium</impact_level>
        <impact_type>best_practices</impact_type>
        <recommendation/>
        <script><![CDATA[// Result should be an array of findings
// A finding should have the following attributes: impact_type, impact_level, record_table, record_sys_id and recommendation
// Before returning result, JSON.stringify it.
// Example: result = '[{"impact_type":"Consistency","impact_level":"High","record_sys_id":"69df2b704fbc620024cf4e328110c7f5","record_table":"ldap_ou_config","recommendation":"Version in this update set is not the latest!"},{"type":"Consistency","criticality":"High","record_sys_id":"acfa8cc34f20220024cf4e328110c74f","record_table":"sys_dictionary","recommendation":"Version in this update set is not the latest!"}]';
// 'current' is the Code itself, related to the table that this applies (It's null in case you don't have a table set)
// 'update_set_item' is the sys_update_xml item
// 'setID' is the update set sys_id

(function (current, update_set_item, setID) {
	//Initialize findings array and finding object 
	var findings = [];
	var finding  = {
			impact_type : 'Best Practices',
			impact_level : 'Medium',
			recommendation : "Please be aware that mapping to a reference field can potentially create an unexpected record in the reference field's table if that referenced value does not exist."
		};
	
	//Check if the field is a reference field and if choice action is create 
	//If this is true then send warning message
	//Otherwise return empty array
	var sysDictionary = new GlideRecord('sys_dictionary');
	sysDictionary.addQuery('internal_type','reference');
	sysDictionary.addQuery('element',current.target_field);
	sysDictionary.addQuery('name',current.target_table);
	sysDictionary.query();
	if(current.choice_action == 'create' && sysDictionary.next()){
		finding.record_sys_id = current.sys_id.toString();
		finding.record_table  = current.sys_class_name.toString();
		findings.push(finding);
	}
	result = JSON.stringify(findings);
	
	

	// Start your script here
})(current, update_set_item, setID);]]></script>
        <short_description>Mapping to reference field on transform map</short_description>
        <sys_class_name>x_wms_pulse_sn_scan_rule</sys_class_name>
        <sys_created_by>m0m01mq</sys_created_by>
        <sys_created_on>2019-03-25 19:41:52</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>414a9b9bdb907b0415c2581bdc9619ea</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_name>Mapping to reference field on transform map</sys_name>
        <sys_package display_value="Pulse" source="x_wms_pulse">e970e883db6bdb0c1f0d322b7c9619a2</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Pulse">e970e883db6bdb0c1f0d322b7c9619a2</sys_scope>
        <sys_update_name>x_wms_pulse_sn_scan_rule_414a9b9bdb907b0415c2581bdc9619ea</sys_update_name>
        <sys_updated_by>m0m01mq</sys_updated_by>
        <sys_updated_on>2019-03-25 20:36:13</sys_updated_on>
    </x_wms_pulse_sn_scan_rule>
</record_update>
